<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Pendaftaran Anggota GOPAN</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Poppins:wght@400;600&display=swap');

* { box-sizing: border-box; }
body {
  font-family: 'Poppins', sans-serif;
  margin:0; padding:0;
  background: linear-gradient(to right, #f5f9ff, #eef4fa);
  color:#333; line-height:1.6;
}
.container { max-width: 1100px; margin:auto; padding:0 15px; }

/* HEADER */
header {
  background: linear-gradient(135deg, #002855, #004a99);
  padding:20px 0;
  box-shadow: 0 6px 18px rgba(0,0,0,0.2);
  border-bottom: 4px solid #ffd700;
}
.header-top { display:flex; align-items:center; justify-content:center; gap:15px; flex-wrap:wrap; text-align:center; }
.header-logo { width:75px; border-radius:15px; box-shadow:0 6px 15px rgba(255,215,0,0.5); border:3px solid #ffd700; }
.header-title h1 { font-family:'Playfair Display', serif; font-size:1.8rem; margin:0; color:#fff; letter-spacing:1px; }
.header-title span { color:#ffd700; }
.header-title p { color:#eef6ff; margin:5px 0 0; font-size:0.95rem; }

/* SECTION TITLE */
.section-title { text-align:center; margin:0 0 20px; color:#002855; font-weight:700; font-size:1.4rem; border-bottom:3px solid #ffd700; display:inline-block; padding-bottom:5px; }

/* FORM */
.form-section { padding:30px 0; }
form#anggotaForm { background:#fff; padding:25px; border-radius:14px; box-shadow:0 6px 18px rgba(0,0,0,0.1); }
.form-group { margin-bottom:15px; }
label { font-weight:600; color:#002855; display:block; margin-bottom:6px; }
input, select { width:100%; padding:12px; border-radius:10px; border:1px solid #ccd9e6; font-size:1rem; outline:none; }
input:focus, select:focus { border-color:#004a99; box-shadow:0 0 6px rgba(79,163,255,0.5); }
.kandang-group { padding:15px; border:1px solid #e0e9f5; border-radius:12px; margin-bottom:15px; background:#f9fbff; position:relative; }
.removeKandang { position:absolute; top:10px; right:10px; padding:5px 10px; border:none; border-radius:6px; background:#ff4d4d; color:#fff; cursor:pointer; font-size:0.8rem; font-weight:600; }
.removeKandang:hover { background:#cc0000; }
.form-row { display:grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap:12px; }

/* BUTTONS */
.form-actions { display:flex; justify-content:center; margin-top:20px; gap:10px; flex-wrap:wrap; }
.fancy-btn { padding:12px 20px; font-size:0.95rem; font-weight:600; color:#fff; background: linear-gradient(135deg, #002855, #004a99); border:none; border-radius:10px; cursor:pointer; box-shadow:0 4px 12px rgba(0,40,85,0.3); }
.fancy-btn:hover { transform: translateY(-2px); box-shadow:0 8px 16px rgba(0,40,85,0.4); }
.logout-btn { background: linear-gradient(135deg, #ff4b5c, #dc3545); }

/* TABLE STATUS */
.table-section { padding:25px 0; }
.table-wrapper { overflow-x:auto; border-radius:10px; box-shadow:0 4px 12px rgba(0,0,0,0.08); }
table { width:100%; border-collapse:collapse; background:#fff; border-radius:10px; overflow:hidden; min-width:300px; }
th { background: linear-gradient(135deg, #002855, #004a99); color:#fff; padding:12px; text-align:center; font-weight:600; white-space: nowrap; font-size:0.95rem; }
td { padding:12px; border-bottom:1px solid #eee; font-size:0.9rem; text-align:center; }
tr:hover { background:#f0f6ff; }

/* Status text */
.statusPending { color:#856404; font-weight:600; }
.statusDiterima { color:#155724; font-weight:600; }
.statusDitolak { color:#721c24; }

/* Status row background */
tr.statusPendingRow { background:#fff3cd; }    /* kuning muda */
tr.statusDiterimaRow { background:#d4edda; }   /* hijau muda */
tr.statusDitolakRow { background:#f8d7da; }     /* merah muda */

/* RESPONSIVE */
@media (max-width:576px) {
  .header-logo { width:60px; }
  .header-title h1 { font-size:1.3rem; }
  .header-title p { font-size:0.85rem; }
  form#anggotaForm { padding:18px; }
  .fancy-btn { padding:10px 16px; font-size:0.85rem; }
}
</style>
</head>
<body>

<header>
  <div class="container">
    <div class="header-top">
      <img src="img/gopan-pengaduan.jpg" alt="Logo GOPAN" class="header-logo">
      <div class="header-title">
        <h1>Pendaftaran Anggota <span>GOPAN</span></h1>
        <p>Bergabung bersama, majukan peternakan rakyat</p>
      </div>
    </div>
  </div>
</header>

<div class="container">

  <!-- FORM -->
  <section class="form-section">
    <form id="anggotaForm">
      <h2 class="section-title">Form Pendaftaran Anggota</h2>
      <div class="form-group">
        <label for="nama">Nama Lengkap</label>
        <input type="text" id="nama" placeholder="Masukkan nama lengkap" required>
      </div>
      <div class="form-group">
        <label for="hp">No HP</label>
        <input type="tel" id="hp" placeholder="10-13 digit nomor HP" required>
      </div>
      <div id="kandangContainer"></div>

      <div class="form-actions">
        <button type="button" class="fancy-btn" onclick="addKandang()">‚ûï Tambah Kandang</button>
        <button type="submit" class="fancy-btn">‚ú® Simpan Anggota ‚ú®</button>
        <button type="button" class="fancy-btn logout-btn" onclick="logout()">üö™ Logout</button>
      </div>
    </form>
  </section>
  
<!-- TABEL STATUS -->
<section class="table-section">
  <h2 class="section-title">Status Pendaftaran Anda</h2>
  <div class="table-wrapper">
    <table id="statusTable">
      <thead>
        <tr>
          <th>No. Antrian</th>
          <th>Status</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td colspan="2">Belum ada pendaftaran</td>
        </tr>
      </tbody>
    </table>
  </div>
</section>
</div>

</body>
</html>

<script>
// ===== LOGIN SIMULASI =====
const currentUser = { id: 1, role: 'admin' };

// ===== DATABASE =====
let db;
const dbName = "anggotaDB";
const storeName = "anggotaList";

// INISIALISASI DB
function initDB(){
  const request = indexedDB.open(dbName,1);
  request.onerror = e => console.error("DB Error", e);
  request.onsuccess = e => { db = e.target.result; loadStatus(); };
  request.onupgradeneeded = e => {
    db = e.target.result;
    if(!db.objectStoreNames.contains(storeName)){
      db.createObjectStore(storeName,{keyPath:'id', autoIncrement:true});
    }
  };
}

// SAVE DATA
function saveData(item, callback){
  const tx = db.transaction(storeName,"readwrite");
  const store = tx.objectStore(storeName);
  const req = store.put(item);
  req.onsuccess = ()=>{ callback(); loadStatus(); };
  req.onerror = e=>console.error(e);
}

// FORM & KANDANG
const anggotaForm = document.getElementById('anggotaForm');
const kandangContainer = document.getElementById('kandangContainer');

function addKandang(){
  const div = document.createElement('div');
  div.className = 'kandang-group';
  div.innerHTML = `
    <div class="form-row">
      <div><label>Domisili Kandang</label><input type="text" class="domisili" placeholder="Masukkan domisili kandang" required></div>
      <div><label>Populasi</label><input type="number" class="populasi" placeholder="Jumlah populasi" min="1" required></div>
      <div><label>Status Kandang</label>
        <select class="statusKandang" required>
          <option value="">-- Pilih Status --</option>
          <option value="sendiri">Sendiri</option>
          <option value="sewa">Sewa</option>
        </select>
      </div>
    </div>
    <button type="button" class="removeKandang">‚ùå Hapus</button>
  `;
  kandangContainer.appendChild(div);
}

// Hapus kandang
kandangContainer.addEventListener('click', e=>{
  if(e.target.classList.contains('removeKandang')){
    e.target.parentElement.remove();
  }
});

// SUBMIT FORM
anggotaForm.addEventListener('submit', e=>{
  e.preventDefault();
  const nama = document.getElementById('nama').value.trim();
  const hp = document.getElementById('hp').value.trim();
  const kandangs = [];
  let valid = true;

  document.querySelectorAll('#kandangContainer .kandang-group').forEach(g=>{
    const domisili = g.querySelector('.domisili').value.trim();
    const populasi = parseInt(g.querySelector('.populasi').value) || 0;
    const status = g.querySelector('.statusKandang').value;
    if(!domisili || !populasi || !status){
      alert('Isi semua field kandang!');
      valid = false;
      return;
    }
    kandangs.push({domisili, populasi, status});
  });
  if(!valid) return;

  saveData({
    nama,
    hp,
    kandang: kandangs,
    statusAnggota:'Pending', // Default status
    alasan:'Belum ada alasan', // Bisa diganti admin
    createdBy: currentUser.id
  }, ()=>{
    resetForm();

    const tx = db.transaction(storeName,'readonly');
    const store = tx.objectStore(storeName);
    const req = store.getAll();
    req.onsuccess = e=>{
      const allData = e.target.result.sort((a,b)=>a.id-b.id);
      const userData = allData.filter(item=>item.createdBy===currentUser.id);
      const index = userData.findIndex(item=>item.nama===nama && item.hp===hp && item.statusAnggota==='Pending');
      const nomorAntrian = index + 1;
      alert(`Pendaftaran berhasil dikirim.\nNomor antrian Anda: ${nomorAntrian}\nAdmin akan meninjau data Anda segera.`);
      loadStatus();
    };
  });
});

// RESET FORM
function resetForm(){
  anggotaForm.reset();
  kandangContainer.innerHTML='';
  addKandang();
}

// LOAD STATUS
function loadStatus(){
  const tx = db.transaction(storeName,'readonly');
  const store = tx.objectStore(storeName);
  const req = store.getAll();
  req.onsuccess = e=>{
    const allData = e.target.result.sort((a,b)=>a.id-b.id);
    const userData = allData.filter(item=>item.createdBy===currentUser.id);
    const tbody = document.querySelector('#statusTable tbody');
    tbody.innerHTML = '';
    if(userData.length===0){
      tbody.innerHTML = '<tr><td colspan="2">Belum ada pendaftaran</td></tr>';
      return;
    }
    userData.forEach((item,index)=>{
      const tr = document.createElement('tr');

      // Tambahkan class row berdasarkan status
      if(item.statusAnggota==='Diterima') tr.className='statusDiterimaRow';
      else if(item.statusAnggota==='Ditolak') tr.className='statusDitolakRow';
      else tr.className='statusPendingRow';

      // Jika ditolak, tampilkan alasan
      const statusText = item.statusAnggota==='Ditolak'
        ? `Ditolak (Alasan: ${item.alasan})`
        : item.statusAnggota;

      tr.innerHTML = `<td>${index+1}</td>
                      <td><span class="${
                        item.statusAnggota==='Diterima'?'statusDiterima':
                        item.statusAnggota==='Ditolak'?'statusDitolak':'statusPending'
                      }">${statusText}</span></td>`;
      tbody.appendChild(tr);
    });
  };
}

// LOGOUT
function logout(){
  alert('Anda berhasil logout!');
  window.location.href='login.html';
}

// INIT
document.addEventListener('DOMContentLoaded', ()=>{
  initDB();
  resetForm();
});
</script>

